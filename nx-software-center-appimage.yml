# appimage-builder recipe see https://appimage-builder.readthedocs.io for details
version: 1

script:
  - rm -rf ./AppDir || true
  - export DESTDIR=$PWD/AppDir
  - scripts/install-build-deps.sh
  - mkdir -p build
  - cd build
  - ../scripts/deploy-mauikit.sh
  - ../scripts/deploy-mauikit-imagetools.sh
  - ../scripts/deploy-mauikit-filebrowsing.sh
  - ../scripts/deploy-nx-software-center.sh
  - ../scripts/install-icon-theme.sh

AppDir:
  path: ./AppDir
  app_info:
    id: nx-software-center
    name: nx-software-center
    icon: nx-software-center
    version: latest
    exec: usr/bin/nx-software-center
    exec_args: $@
  runtime:
    env:
      PATH: '${APPDIR}/usr/bin:${APPDIR}/bin:${APPDIR}/usr/lib/x86_64-linux-gnu/libexec/kf5:${PATH}'
      APPDIR_LIBRARY_PATH: "$APPDIR/lib/x86_64-linux-gnu:$APPDIR/usr/lib/x86_64-linux-gnu"
      QT_QUICK_CONTROLS_STYLE: "maui-style"
  after_bundle:
    - cd $APPDIR/bin/ && ln -sf bash sh
  apt:
    arch:
    - amd64
    allow_unauthenticated: true
    sources:
    - sourceline: deb http://archive.ubuntu.com/ubuntu/ focal main restricted universe multiverse
    - sourceline: deb http://security.ubuntu.com/ubuntu/ focal-security main restricted universe multiverse
    - sourceline: deb http://archive.ubuntu.com/ubuntu/ focal-updates main restricted universe multiverse
    - sourceline: deb http://archive.neon.kde.org/user focal main
      key_url: 'http://archive.neon.kde.org/public.key'
    - sourceline: deb https://packagecloud.io/nitrux/repo/debian/ trixie main
      key_url: 'https://packagecloud.io/nitrux/repo/gpgkey'

# include vs exclude: using both lists act as whitelist.
#
# If a package is listed in include and exclude it's whitelisted and included in the AppImage.
# If it's only in exclude it's excluded and not added to the AppImage.
#
# only necessary dependencies should be in include.

    include:
    # CORE DEPENDENCIES
    - bash
    - coreutils
    - gettext
    
    # BASIC QT DEPENDENCIES
    - libqt5core5a
    - libqt5network5
    - libqt5quick5
    - libqt5quickcontrols2-5
    - libqt5quickshapes5
    - libqt5quicktemplates2-5
    - libqt5sql5
    - libqt5sql5-sqlite
    - libqt5svg5
    - libqt5x11extras5
    - libqt5xml5
    - qt5-image-formats-plugins
    - libqt5widgets5
    
    # QT QUICK DEPENDENCIES
    - qml-module-qtqml-workerscript2
    - qml-module-qtquick-controls
    - qml-module-qtquick-controls2
    - qml-module-qtquick-dialogs
    - qml-module-qtquick-layouts
    - qml-module-qtquick-privatewidgets
    - qml-module-qtquick-shapes
    - qml-module-qtquick-templates2
    - qml-module-qtquick-window2
    - qml-module-qtquick2
    
    # KF5 DEPENDENCIES
    - kinit
    - kio
    - kio-extras
    - libkdecorations2-5v5
    - libkdecorations2private7
    - libkf5configcore5
    - libkf5configgui5
    - libkf5configwidgets5
    - libkf5coreaddons-data
    - libkf5coreaddons5
    - libkf5i18n5
    - libkf5kiofilewidgets5
    - libkf5kirigami2-5
    - libkf5notifications5
    - libkf5plasma5
    - libkf5plasmaquick5
    - libkf5syntaxhighlighting5
    - libkf5windowsystem-data
    - libkf5windowsystem5
    - libkf5kiowidgets5
    - libkf5kiogui5
    - libkf5kiocore5

    # Other
    # - qml-module-org-kde-mauikit
    # - qml-module-org-mauikit-filebrowsing
    # - qml-module-org-mauikit-imagetools
    - libappimage1.0
    - libgdk-pixbuf2.0-0
    - librsvg2-common
    - libtag1v5
    - qml-module-org-kde-kirigami2
    - qml-module-org-kde-kquickimageeditor
    - qml-module-qt-labs-platform
    - qml-module-qt-labs-settings
    - qml-module-qtgraphicaleffects
    - qml-module-qtqml
    - qml-module-qtqml-models2
    - qml-module-qtqml-statemachine
    - libfam0
    - libicu66

    exclude:
    - bash
    - coreutils
    - dirmngr
    - gamin
    - gcc-10-base
    - gettext
    - gettext-base
    - gnupg
    - gnupg-l10n
    - gnupg-utils
    - gpg
    - gpg-agent
    - gpg-wks-client
    - gpg-wks-server
    - gpgconf
    - gpgsm
    - gpgv
    - kded5
    - kinit
    - kio
    - kio-extras
    - kio-extras-data
    - kwayland-data
    - liba52-0.7.4
    - libaa1
    - libacl1
    - libaom0
    - libapparmor1
    - libappimage1.0
    - libarchive13
    - libargon2-1
    - libaribb24-0
    - libasn1-8-heimdal
    - libasound2
    - libasound2-data
    - libass9
    - libassuan0
    - libasyncns0
    - libattr1
    - libaudit-common
    - libaudit1
    - libavahi-client3
    - libavahi-common-data
    - libavahi-common3
    - libavc1394-0
    - libavcodec58
    - libavformat58
    - libavutil56
    - libbasicusageenvironment1
    - libblkid1
    - libbluray2
    - libbsd0
    - libbz2-1.0
    - libc6
    - libcaca0
    - libcairo-gobject2
    - libcairo2
    - libcanberra0
    - libcap-ng0
    - libcap2
    - libcddb2
    - libchromaprint1
    - libcodec2-0.9
    - libcom-err2
    - libcroco3
    - libcrypt1
    - libcryptsetup12
    - libcups2
    - libdatrie1
    - libdb5.3
    - libdbus-1-3
    - libdbusmenu-qt5-2
    - libdc1394-22
    - libdca0
    - libdevmapper1.02.1
    - libdouble-conversion3
    - libdvbpsi10
    - libdvdnav4
    - libdvdread7
    - libebml4v5
    - libepoxy0
    - libevdev2
    - libexpat1
    - libfaad2
    - libffi7
    - libflac8
    - libfontconfig1
    - libfreetype6
    - libfribidi0
    - libfuse2
    - libgamin0
    - libgcc-s1
    - libgcrypt20
    - libgdbm-compat4
    - libgdbm6
    - libgdk-pixbuf2.0-0
    - libgdk-pixbuf2.0-common
    - libglib2.0-0
    - libgme0
    - libgmp10
    - libgnutls30
    - libgomp1
    - libgpg-error0
    - libgpgme11
    - libgpgmepp6
    - libgpm2
    - libgraphite2-3
    - libgroupsock8
    - libgsm1
    - libgssapi-krb5-2
    - libgssapi3-heimdal
    - libgudev-1.0-0
    - libharfbuzz0b
    - libhcrypto4-heimdal
    - libheimbase1-heimdal
    - libheimntlm0-heimdal
    - libhogweed5
    - libhx509-5-heimdal
    - libice6
    - libicu66
    - libidn11
    - libidn2-0
    - libilmbase24
    - libinput10
    - libip4tc2
    - libixml10
    - libjansson4
    - libjasper4
    - libjbig0
    - libjpeg-turbo8
    - libjpeg8
    - libjson-c4
    - libk5crypto3
    - libkate1
    - libkdecorations2-5v5
    - libkdecorations2private7
    - libkdecorations2private8
    - libkdsoap2
    - libkeyutils1
    - libkf5activities5
    - libkf5activitiesstats1
    - libkf5archive5
    - libkf5auth-data
    - libkf5authcore5
    - libkf5bookmarks-data
    - libkf5bookmarks5
    - libkf5codecs-data
    - libkf5codecs5
    - libkf5completion-data
    - libkf5completion5
    - libkf5config-data
    - libkf5configcore5
    - libkf5configgui5
    - libkf5configwidgets-data
    - libkf5configwidgets5
    - libkf5coreaddons-data
    - libkf5coreaddons5
    - libkf5crash5
    - libkf5dbusaddons-data
    - libkf5dbusaddons5
    - libkf5declarative-data
    - libkf5declarative5
    - libkf5dnssd-data
    - libkf5dnssd5
    - libkf5doctools5
    - libkf5globalaccel-data
    - libkf5globalaccel5
    - libkf5guiaddons5
    - libkf5i18n-data
    - libkf5i18n5
    - libkf5iconthemes-data
    - libkf5iconthemes5
    - libkf5itemviews-data
    - libkf5itemviews5
    - libkf5jobwidgets-data
    - libkf5jobwidgets5
    - libkf5kiocore5
    - libkf5kiofilewidgets5
    - libkf5kiogui5
    - libkf5kiontlm5
    - libkf5kiowidgets5
    - libkf5kirigami2-5
    - libkf5notifications-data
    - libkf5notifications5
    - libkf5package-data
    - libkf5package5
    - libkf5plasma5
    - libkf5plasmaquick5
    - libkf5quickaddons5
    - libkf5service-data
    - libkf5service5
    - libkf5solid5
    - libkf5solid5-data
    - libkf5sonnet5-data
    - libkf5sonnetcore5
    - libkf5sonnetui5
    - libkf5syntaxhighlighting-data
    - libkf5syntaxhighlighting5
    - libkf5textwidgets-data
    - libkf5textwidgets5
    - libkf5wallet-data
    - libkf5wallet5
    - libkf5waylandclient5
    - libkf5widgetsaddons-data
    - libkf5widgetsaddons5
    - libkf5windowsystem-data
    - libkf5windowsystem5
    - libkf5xmlgui-data
    - libkf5xmlgui5
    - libkmod2
    - libkrb5-26-heimdal
    - libkrb5-3
    - libkrb5support0
    - libksba8
    - libkwalletbackend5-5
    - liblcms2-2
    - libldap-2.4-2
    - libldap-common
    - libldb2
    - liblirc-client0
    - liblivemedia77
    - liblmdb0
    - libltdl7
    - liblua5.2-0
    - liblz4-1
    - liblzma5
    - liblzo2-2
    - libmad0
    - libmatroska6v5
    - libmd4c0
    - libmng2
    - libmount1
    - libmp3lame0
    - libmpcdec6
    - libmpdec2
    - libmpeg2-4
    - libmpg123-0
    - libmtdev1
    - libmtp-common
    - libmtp9
    - libmysofa1
    - libncurses6
    - libncursesw6
    - libnettle7
    - libnfs13
    - libnpth0
    - libnuma1
    - libogg0
    - libopenexr24
    - libopenjp2-7
    - libopenmpt-modplug1
    - libopenmpt0
    - libopus0
    - libp11-kit0
    - libpam-systemd
    - libpam0g
    - libpango-1.0-0
    - libpangocairo-1.0-0
    - libpangoft2-1.0-0
    - libpcre2-16-0
    - libpcre2-8-0
    - libpcre3
    - libperl5.30
    - libphonon4qt5-4
    - libphonon4qt5-data
    - libpixman-1-0
    - libplacebo7
    - libpng16-16
    - libpolkit-agent-1-0
    - libpolkit-gobject-1-0
    - libpolkit-qt5-1-1
    - libpopt0
    - libpostproc55
    - libprotobuf-lite17
    - libpulse-mainloop-glib0
    - libpulse0
    - libpython3-stdlib
    - libpython3.8
    - libpython3.8-minimal
    - libpython3.8-stdlib
    - libqt5core5a
    - libqt5dbus5
    - libqt5gui5
    - libqt5network5
    - libqt5printsupport5
    - libqt5qml5
    - libqt5qmlmodels5
    - libqt5qmlworkerscript5
    - libqt5quick5
    - libqt5quickcontrols2-5
    - libqt5quickshapes5
    - libqt5quicktemplates2-5
    - libqt5sql5
    - libqt5sql5-sqlite
    - libqt5svg5
    - libqt5texttospeech5
    - libqt5waylandclient5
    - libqt5waylandcompositor5
    - libqt5widgets5
    - libqt5x11extras5
    - libqt5xml5
    - libraw1394-11
    - libreadline8
    - libresid-builder0c2a
    - libroken18-heimdal
    - librsvg2-2
    - librsvg2-common
    - libsamplerate0
    - libsasl2-2
    - libsasl2-modules-db
    - libsdl-image1.2
    - libsdl1.2debian
    - libseccomp2
    - libsecret-1-0
    - libsecret-common
    - libselinux1
    - libshine3
    - libshout3
    - libsidplay2
    - libslang2
    - libsm6
    - libsmbclient
    - libsnappy1v5
    - libsndfile1
    - libsndio7.0
    - libsoxr0
    - libspatialaudio0
    - libspeex1
    - libspeexdsp1
    - libsqlite3-0
    - libsquashfuse0
    - libsrt1
    - libssh-4
    - libssh-gcrypt-4
    - libssh2-1
    - libssl1.1
    - libstdc++6
    - libswresample3
    - libswscale5
    - libsystemd0
    - libtag1v5
    - libtag1v5-vanilla
    - libtalloc2
    - libtasn1-6
    - libtdb1
    - libtevent0
    - libthai-data
    - libthai0
    - libtheora0
    - libtiff5
    - libtinfo6
    - libtirpc-common
    - libtirpc3
    - libtwolame0
    - libudev1
    - libunistring2
    - libupnp13
    - libusageenvironment3
    - libusb-1.0-0
    - libuuid1
    - libva-drm2
    - libva-wayland2
    - libva-x11-2
    - libva2
    - libvdpau1
    - libvlc5
    - libvlccore9
    - libvorbis0a
    - libvorbisenc2
    - libvorbisfile3
    - libvpx6
    - libvulkan1
    - libwacom-common
    - libwacom2
    - libwavpack1
    - libwayland-client0
    - libwayland-cursor0
    - libwayland-egl1
    - libwayland-server0
    - libwbclient0
    - libwebp6
    - libwebpdemux2
    - libwebpmux3
    - libwind0-heimdal
    - libwrap0
    - libx264-155
    - libx265-179
    - libxcb-icccm4
    - libxcb-image0
    - libxcb-keysyms1
    - libxcb-randr0
    - libxcb-render-util0
    - libxcb-res0
    - libxcb-sync1
    - libxcb-util1
    - libxcb-xinerama0
    - libxcb-xinput0
    - libxcb-xkb1
    - libxcb-xv0
    - libxcomposite1
    - libxext6
    - libxfixes3
    - libxkbcommon-x11-0
    - libxkbcommon0
    - libxml2
    - libxrender1
    - libxslt1.1
    - libxvidcore4
    - libzstd1
    - libzvbi-common
    - libzvbi0
    - mime-support
    - ocl-icd-libopencl1
    - perl
    - perl-base
    - perl-modules-5.30
    - phonon4qt5
    - phonon4qt5-backend-vlc
    - pinentry-curses
    - python3
    - python3-minimal
    - python3-talloc
    - python3.8
    - python3.8-minimal
    - qml-module-org-kde-kirigami2
    - qml-module-org-kde-kquickcontrolsaddons
    - qml-module-org-kde-kquickimageeditor
    - qml-module-qt-labs-folderlistmodel
    - qml-module-qt-labs-platform
    - qml-module-qt-labs-settings
    - qml-module-qtgraphicaleffects
    - qml-module-qtqml
    - qml-module-qtqml-models2
    - qml-module-qtqml-statemachine
    - qml-module-qtqml-workerscript2
    - qml-module-qtquick-controls
    - qml-module-qtquick-controls2
    - qml-module-qtquick-dialogs
    - qml-module-qtquick-layouts
    - qml-module-qtquick-privatewidgets
    - qml-module-qtquick-shapes
    - qml-module-qtquick-templates2
    - qml-module-qtquick-window2
    - qml-module-qtquick2
    - qt5-image-formats-plugins
    - qtwayland5
    - readline-common
    - samba-libs
    - sound-theme-freedesktop
    - systemd
    - systemd-timesyncd
    - tzdata
    - vlc-data
    - vlc-plugin-base
    - vlc-plugin-video-output
    - xkb-data
    - zlib1g

  files:
    include:
    - /usr/bin/which
    exclude:
    - usr/share/man
    - usr/share/doc/*/README.*
    - usr/share/doc/*/changelog.*
    - usr/share/doc/*/NEWS.*
    - usr/share/doc/*/TODO.*

  test:
    fedora-30:
      image: appimagecrafters/tests-env:fedora-30
      command: ./AppRun -v
      use_host_x: true
    debian-stable:
      image: appimagecrafters/tests-env:debian-stable
      command: ./AppRun -v
      use_host_x: true
    archlinux-latest:
      image: appimagecrafters/tests-env:archlinux-latest
      command: ./AppRun -v
      use_host_x: true
    centos-7:
      image: appimagecrafters/tests-env:centos-7
      command: ./AppRun -v
      use_host_x: true
    ubuntu-xenial:
      image: appimagecrafters/tests-env:ubuntu-xenial
      command: ./AppRun -v  
      use_host_x: true

AppImage:
  arch: x86_64
  update-information: gh-releases-zsync|Nitrux|nx-software-center|latest|*x86_64.AppImage.zsync